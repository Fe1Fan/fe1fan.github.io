<!doctype html><html><head><title>MySQL 笔记5：事务 // Fe1Fan</title><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="学习笔记"><meta property="og:title" content="MySQL 笔记5：事务"><meta property="og:description" content="学习笔记"><meta property="og:type" content="website"><meta property="og:locale" content="en"><meta property="og:url" content="https://fe1.fan/posts/mysql/mysql-note-5/"><link rel="shortcut icon" href=/favicon.ico><link href=https://fe1.fan/webfonts/ptserif/main.css rel=stylesheet type=text/css><link href=https://fe1.fan/webfonts/source-code-pro/main.css rel=stylesheet type=text/css><link rel=stylesheet href=https://fe1.fan/css/style.css><meta name=generator content="Hugo 0.75.1"></head><body><div id=container><header id=header><div id=header-outer class=outer><div id=header-inner class=inner><a id=main-nav-toggle class=nav-icon href=javascript:;></a><a id=logo class=logo-text href=https://fe1.fan/>Fe1Fan</a><nav id=main-nav><a class=main-nav-link href=/>主页</a>
<a class=main-nav-link href=/tags/>归档</a>
<a class=main-nav-link href=/about/>关于</a>
<a class=main-nav-link href=/index.xml>订阅</a></nav><nav id=sub-nav><div id=search-form-wrap></div></nav></div></div></header><section id=main class=outer><article class="article article-type-post" itemscope itemprop=blogPost><div class=article-inner><header class=article-header><h1 class=article-title itemprop=name>MySQL 笔记5：事务</h1></header><div class=article-meta><a href="/posts/mysql/mysql-note-5/?uid=0b8c149b35655b02d5b78830d383e55f" class=article-date><time datetime=2020-10-07T14:23:52.000+08:00 itemprop=datePublished>2020-10-07</time></a></div><div class=article-entry itemprop=articleBody><h2 id=10-innodb-事务>1.0 InnoDB 事务</h2><p>MySQL 中有一个系统变量 autocommit，默认情况下，如果我们不显式的使用START TRANSACTION或者BEGIN语句开启一个事务，那么每一条语句都算是一个独立的事务，这种特性称之为事务的自动提交。</p><p>如果关闭 autocommit， <code>SET autocommit = OFF;</code> 这样的话，我们写入的多条语句就算是属于同一个事务了，直到我们显式的写出COMMIT语句来把这个事务提交掉，或者显式的写出ROLLBACK语句来把这个事务回滚掉。.</p><h3 id=11-隔离级别>1.1 隔离级别</h3><ul><li><p>读未提交</p><p>可以读取未提交事务已经更改的数据</p></li><li><p>读已提交</p><p>只能读取到已提交事务更改后的数据，每次执行SQL前刷新视图。</p></li><li><p>可重复读</p><p>在初始化时生成视图，整个事务过程读取的内容一致，但是提交更新的时候，数据是按照最新视图来。</p></li><li><p>串行</p><p>。。。</p></li></ul><h3 id=12-隐式提交>1.2 隐式提交</h3><p>当我们使用START TRANSACTION或者BEGIN语句开启了一个事务，或者把系统变量autocommit的值设置为OFF时，事务就不会进行自动提交，但是如果我们输入了某些语句之后就会悄悄的提交掉，就像我们输入了COMMIT语句了一样，这种因为某些特殊的语句而导致事务提交的情况称为隐式提交，这些会导致事务隐式提交的语句包括：</p><ul><li><p>定义或修改数据库对象的数据定义语言（Data definition language，缩写为：DDL）。</p><p>所谓的数据库对象，指的就是数据库、表、视图、存储过程等等这些东西。当我们使用CREATE、ALTER、DROP等语句去修改这些所谓的数据库对象时，就会隐式的提交前边语句所属于的事务。</p></li><li><p>隐式使用或修改mysql数据库中的表</p><p>当我们使用ALTER USER、CREATE USER、DROP USER、GRANT、RENAME USER、REVOKE、SET PASSWORD等语句时也会隐式的提交前边语句所属于的事务。</p></li><li><p>事务控制或关于锁定的语句</p><p>当我们在一个事务还没提交或者回滚时就又使用START TRANSACTION或者BEGIN语句开启了另一个事务时，会隐式的提交上一个事务，</p></li><li><p>加载数据的语句</p><p>比如我们使用LOAD DATA语句来批量往数据库中导入数据时，也会隐式的提交前边语句所属的事务。</p></li><li><p>关于MySQL复制的一些语句</p><p>使用START SLAVE、STOP SLAVE、RESET SLAVE、CHANGE MASTER TO等语句时也会隐式的提交前边语句所属的事务。</p></li><li><p>其它的一些语句</p><p>使用ANALYZE TABLE、CACHE INDEX、CHECK TABLE、FLUSH、 LOAD INDEX INTO CACHE、OPTIMIZE TABLE、REPAIR TABLE、RESET等语句也会隐式的提交前边语句所属的事务。</p></li></ul><h3 id=13-保存点>1.3 保存点</h3><p>如果你开启了一个事务，并且已经敲了很多语句，忽然发现上一条语句有点问题，你只好使用ROLLBACK语句来让数据库状态恢复到事务执行之前的样子，然后一切从头再来，总有一种一夜回到解放前的感觉。</p><p>保存点就是在事务对应的数据库语句中打几个点，我们在调用ROLLBACK语句时可以指定会滚到哪个点，而不是回到最初的原点。</p><pre><code class=language-sql>SAVEPOINT 保存点名称;
</code></pre><p>当我们想回滚到某个保存点时:</p><pre><code class=language-sql>ROLLBACK [WORK] TO [SAVEPOINT] 保存点名称;
</code></pre><p>删除保存点：</p><pre><code class=language-sql>RELEASE SAVEPOINT 保存点名称;
</code></pre><p>//TODO redo
//TODO undo</p></div><div class=article-toc><h3>Contents</h3><nav id=TableOfContents><ul><li><a href=#10-innodb-事务>1.0 InnoDB 事务</a><ul><li><a href=#11-隔离级别>1.1 隔离级别</a></li><li><a href=#12-隐式提交>1.2 隐式提交</a></li><li><a href=#13-保存点>1.3 保存点</a></li></ul></li></ul></nav></div><footer class=article-footer><ul class=article-tag-list><li class=article-tag-list-item><a class=article-tag-list-link href=https://fe1.fan/tags/mysql>mysql</a></li></ul></footer></div><nav id=article-nav><a href=/posts/mysql/mysql-note-3/ id=article-nav-newer class=article-nav-link-wrap><div class=article-nav-title><span>&lt;</span>&nbsp;
MySQL 笔记3：索引</div></a><a href=/posts/mysql/mysql-note-6/ id=article-nav-older class=article-nav-link-wrap><div class=article-nav-title>MySQL 笔记6：存储&nbsp;<span>></span></div></a></nav></article></section><footer id=footer><div class=outer><div id=footer-info class=inner>&copy; 2021 Fe1Fan<br>Powered by <a href=https://gohugo.io target=_blank>Hugo</a> with theme <a href=https://github.com/carsonip/hugo-theme-minos target=_blank>Minos</a></div></div><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin=anonymous></script><script>hljs.initHighlightingOnLoad();</script><script>document.getElementById('main-nav-toggle').addEventListener('click',function(){var header=document.getElementById('header');if(header.classList.contains('mobile-on')){header.classList.remove('mobile-on');}else{header.classList.add('mobile-on');}});</script></footer></div></body></html>