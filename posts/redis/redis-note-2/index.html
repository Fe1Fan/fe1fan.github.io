<!doctype html><html><head><title>Redis 笔记2：文件事件处理器 // Fe1Fan</title><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="学习笔记"><meta property="og:title" content="Redis 笔记2：文件事件处理器"><meta property="og:description" content="学习笔记"><meta property="og:type" content="website"><meta property="og:locale" content="en"><meta property="og:url" content="https://fe1.fan/posts/redis/redis-note-2/"><link rel="shortcut icon" href=/favicon.ico><link href=https://fe1.fan/webfonts/ptserif/main.css rel=stylesheet type=text/css><link href=https://fe1.fan/webfonts/source-code-pro/main.css rel=stylesheet type=text/css><link rel=stylesheet href=https://fe1.fan/css/style.css><meta name=generator content="Hugo 0.75.1"></head><body><div id=container><header id=header><div id=header-outer class=outer><div id=header-inner class=inner><a id=main-nav-toggle class=nav-icon href=javascript:;></a><a id=logo class=logo-text href=https://fe1.fan/>Fe1Fan</a><nav id=main-nav><a class=main-nav-link href=/>主页</a>
<a class=main-nav-link href=/tags/>归档</a>
<a class=main-nav-link href=/about/>关于</a>
<a class=main-nav-link href=/index.xml>订阅</a></nav><nav id=sub-nav><div id=search-form-wrap></div></nav></div></div></header><section id=main class=outer><article class="article article-type-post" itemscope itemprop=blogPost><div class=article-inner><header class=article-header><h1 class=article-title itemprop=name>Redis 笔记2：文件事件处理器</h1></header><div class=article-meta><a href="/posts/redis/redis-note-2/?uid=30965655e730ef03db5dca6caebce00d" class=article-date><time datetime=2020-10-07T14:23:52.000+08:00 itemprop=datePublished>2020-10-07</time></a></div><div class=article-entry itemprop=articleBody><h2 id=10-文件事件处理器>1.0 文件事件处理器</h2><p><img src=https://i.loli.net/2021/05/26/8h1KHfMXNaAbsL9.jpg alt=00015.jpg></p><p>这套结构被称为文件事件处理器，基于Reactor模式，采用I/O多路服用的程序同时监听多个套接字。</p><p>当被监听的套接字准备好执行链接应答、读取、写入、关闭等操作时，与操作相对应的文件事件就会产生，这时文件事件处理器就会调用套接字之前关联好的事件
处理器来处理这些事件。</p><ul><li>I/O多路复用程序</li><li>文件事件分派器</li><li>文件事件处理器</li></ul><p>当文件事件触发时，I/O多路复用程序总会将所有产生事件的套接字都放在一个队列里，然后通过这个队列以有序、同步、
每次一个套接字的方式向文件事件分派器传送套接字。当上一个套接字产生的事件被处理完毕之后（该套接字为事件所关联的事件处理器执行完毕）
I/O多路复用程序才会继续向文件事件分派器传送下一个套接字。</p><h2 id=io-多路复用程序>I/O 多路复用程序</h2><ul><li>select</li><li>epoll</li><li>evport</li><li>kqueue</li></ul><h2 id=文件事件分派器>文件事件分派器</h2><p>负责对不同的事件分配不同的事件处理器。
在Redis中，事件有下面几种类型：</p><ul><li>AE_READABLE 当套接字可读时（Client对Server进行write或close）或者有新的套接字可应答时（Client对Server进行connect）</li><li>AE_WRITABLE 当套接字变得可写时。</li></ul><p>当可读和可写同时发生时，先处理可读套接字，在处理可写套接字。</p><h2 id=文件事件处理器>文件事件处理器</h2><ul><li>链接应答处理器</li><li>命令请求处理器</li><li>命令回复处理器</li></ul><h2 id=执行命令过程分析>执行命令过程分析</h2><ul><li>Server监听套接字的AE_READABLE事件正在处于监听之下，该事件所对应的处理器为连接应答处理器。</li><li>Client发起连接，监听套接字产生AE_READABLE事件，触发链接应答处理器执行。</li><li>Client发起命令执行请求，套接字产生AE_READABLE事件，命令请求处理器执行。</li><li>Server将Client套接字的AE_WRITABLE事件与命令回复处理器进行关联。</li><li>Client尝试读取命令回复的时候，Client套接字产生AE_WRITABLE事件，触发命令回复处理器执行。</li><li>Server将命令回复全部写入套接字后，Server解除客户端套接字的AE_WRITABLE事件与命令回复处理器之间的关联。</li></ul></div><div class=article-toc><h3>Contents</h3><nav id=TableOfContents><ul><li><a href=#10-文件事件处理器>1.0 文件事件处理器</a></li><li><a href=#io-多路复用程序>I/O 多路复用程序</a></li><li><a href=#文件事件分派器>文件事件分派器</a></li><li><a href=#文件事件处理器>文件事件处理器</a></li><li><a href=#执行命令过程分析>执行命令过程分析</a></li></ul></nav></div><footer class=article-footer><ul class=article-tag-list><li class=article-tag-list-item><a class=article-tag-list-link href=https://fe1.fan/tags/redis>redis</a></li></ul></footer><script>MathJax={tex:{inlineMath:[["$","$"]],},displayMath:[["$$","$$"],["\[\[","\]\]"],],svg:{fontCache:"global",},};</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></div><nav id=article-nav><a href=/posts/redis/redis-note-1/ id=article-nav-newer class=article-nav-link-wrap><div class=article-nav-title><span>&lt;</span>&nbsp;
Redis 笔记1：基础</div></a><a href=/posts/redis/redis-note-3/ id=article-nav-older class=article-nav-link-wrap><div class=article-nav-title>Redis 笔记3：时间事件处理器&nbsp;<span>></span></div></a></nav></article></section><footer id=footer><div class=outer><div id=footer-info class=inner>&copy; 2021 Fe1Fan<br>Powered by <a href=https://gohugo.io target=_blank>Hugo</a> with theme <a href=https://github.com/carsonip/hugo-theme-minos target=_blank>Minos</a></div></div><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin=anonymous></script><script>hljs.initHighlightingOnLoad();</script><script>document.getElementById('main-nav-toggle').addEventListener('click',function(){var header=document.getElementById('header');if(header.classList.contains('mobile-on')){header.classList.remove('mobile-on');}else{header.classList.add('mobile-on');}});</script></footer></div></body></html>